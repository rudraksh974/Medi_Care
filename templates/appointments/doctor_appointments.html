{% extends 'base.html' %}

{% block title %}Doctor Appointments | MediPredict{% endblock %}

{% block content %}
  <h1>My Appointments</h1>

  {% if appointments %}
    <!-- Display all appointments for logged-in doctor -->
    <!-- Backend: doctor_appointments view filters by request.user.doctor_profile -->
    <ul class="appointment-list">
      {% for appointment in appointments %}
        <li class="appointment-item">
          <div>
            <strong>Patient:</strong> {{ appointment.patient.get_full_name|default:appointment.patient.username }}
            <br>
            <!-- Date formatting: Django template filter for readable dates -->
            <strong>Appointment Time:</strong> {{ appointment.appointment_time|date:"F d, Y g:i A" }}
            <br>
            <strong>Status:</strong> 
            <span class="status-{{ appointment.status|lower }}">
              {{ appointment.status }}
            </span>
            <br>
            <strong>Booked on:</strong> {{ appointment.created_at|date:"F d, Y" }}
            
            <!-- Approve/Reject buttons: Only shown for pending appointments -->
            <!-- Backend security: update_appointment_status view checks if doctor owns the appointment -->
            {% if appointment.status == "Pending" %}
              <div style="margin-top: 10px;">
                <a href="{% url 'update_appointment_status' appointment.id %}?status=Approved" 
                   class="btn btn-success" 
                   style="margin-right: 10px;">
                  Approve
                </a>
                <a href="{% url 'update_appointment_status' appointment.id %}?status=Rejected" 
                   class="btn btn-danger">
                  Reject
                </a>
              </div>
            {% endif %}
          </div>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <!-- Empty state - gracefully handle when no appointments exist -->
    <div style="text-align: center; padding: 40px; color: #666;">
      <p style="font-size: 18px;">You don't have any appointments yet.</p>
    </div>
  {% endif %}
{% endblock %}
